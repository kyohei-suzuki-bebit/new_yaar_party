<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROJECT: RIDDLE // DECRYPT</title>
    <style>
        :root {
            --primary: #00ff41;
            --bg: #0d0d0d;
            --glitch: #ff00ff;
            --scanline: rgba(0, 255, 65, 0.1);
        }

        body {
            background-color: var(--bg);
            color: var(--primary);
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            text-transform: uppercase;
        }

        /* CRT Effect Overlay */
        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.2));
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 10;
        }

        .container {
            width: 90%;
            max-width: 600px;
            z-index: 2;
            border: 2px solid var(--primary);
            padding: 2rem;
            box-shadow: 0 0 20px var(--primary);
            position: relative;
        }

        h1 {
            font-size: 1.5rem;
            border-bottom: 1px solid var(--primary);
            padding-bottom: 1rem;
            margin-bottom: 2rem;
            text-shadow: 2px 2px var(--glitch);
        }

        .hidden { display: none; }

        input[type="text"] {
            background: transparent;
            border: none;
            border-bottom: 2px solid var(--primary);
            color: var(--primary);
            font-family: inherit;
            font-size: 1.2rem;
            width: 100%;
            margin-top: 1rem;
            outline: none;
        }

        button {
            margin-top: 2rem;
            background: var(--primary);
            color: var(--bg);
            border: none;
            padding: 1rem 2rem;
            font-weight: bold;
            font-family: inherit;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
        }

        button:hover {
            background: #fff;
            box-shadow: 0 0 15px #fff;
        }

        .status-bar {
            margin-top: 1rem;
            font-size: 0.8rem;
            display: flex;
            justify-content: space-between;
        }

        .feedback {
            margin-top: 1rem;
            height: 1.5rem;
            color: #ff3333;
            font-weight: bold;
        }

        /* Glitch Animation */
        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0; }
            100% { opacity: 1; }
        }
        .blink { animation: blink 1s infinite; }

    </style>
</head>
<body>

<div class="scanlines"></div>

<div class="container" id="app">
    <div id="screen-start">
        <h1>System Locked</h1>
        <p>セキュリティ・プロトコルを解除するには、<br>全ての暗号（なぞなぞ）を解読せよ。</p>
        <p class="blink">>>> PRESS START TO INITIALIZE</p>
        <button onclick="startGame()">SYSTEM START</button>
    </div>

    <div id="screen-game" class="hidden">
        <div class="status-bar">
            <span id="q-counter">Q: 1/3</span>
            <span id="timer-display">TIME: 0.00</span>
        </div>
        <h2 id="question-text" style="margin-top: 2rem; line-height: 1.6;"></h2>
        <input type="text" id="answer-input" placeholder="ENTER PASSWORD..." autocomplete="off">
        <div class="feedback" id="feedback-msg"></div>
        <button onclick="checkAnswer()">EXECUTE</button>
    </div>

    <div id="screen-result" class="hidden">
        <h1>Access Granted</h1>
        <p>全プロトコル解除成功。</p>
        <h2 style="font-size: 2.5rem; margin: 2rem 0;">
            TIME: <span id="final-time">0.00</span>s
        </h2>
        <p>スタッフにこの画面を提示してください。</p>
        <p class="blink" style="margin-top:3rem;">>>> END OF SESSION</p>
    </div>
</div>

<script>
    // --- Configuration ---
    const riddles = [
        {
            q: "私は都市にいるが、家はない。<br>山にいるが、木はない。<br>水はあるが、魚はいない。<br>私は何？（漢字2文字）",
            a: ["地図", "ちず", "map"]
        },
        {
            q: "朝は4本足、昼は2本足、夕方は3本足。<br>この生き物は？（漢字2文字）",
            a: ["人間", "にんげん", "ヒト", "ひと", "human"]
        },
        {
            q: "割れても使えるものってなーんだ？<br>（ひらがな3文字）",
            a: ["たまご", "卵", "タマゴ", "egg"]
        }
    ];

    // --- State ---
    let currentQ = 0;
    let startTime = 0;
    let timerInterval;

    // --- Elements ---
    const screens = {
        start: document.getElementById('screen-start'),
        game: document.getElementById('screen-game'),
        result: document.getElementById('screen-result')
    };
    const ui = {
        question: document.getElementById('question-text'),
        input: document.getElementById('answer-input'),
        feedback: document.getElementById('feedback-msg'),
        counter: document.getElementById('q-counter'),
        timer: document.getElementById('timer-display'),
        finalTime: document.getElementById('final-time')
    };

    // --- Functions ---
    function switchScreen(name) {
        Object.values(screens).forEach(el => el.classList.add('hidden'));
        screens[name].classList.remove('hidden');
    }

    function startGame() {
        currentQ = 0;
        startTime = Date.now();
        timerInterval = setInterval(updateTimer, 50);
        showQuestion();
        switchScreen('game');
        ui.input.focus();
    }

    function updateTimer() {
        const diff = (Date.now() - startTime) / 1000;
        ui.timer.innerText = `TIME: ${diff.toFixed(2)}`;
    }

    function showQuestion() {
        ui.question.innerHTML = riddles[currentQ].q;
        ui.counter.innerText = `Q: ${currentQ + 1}/${riddles.length}`;
        ui.input.value = '';
        ui.feedback.innerText = '';
        ui.input.focus();
    }

    function checkAnswer() {
        const userAns = ui.input.value.trim();
        const correctAnswers = riddles[currentQ].a;

        // Simple fuzzy check (case insensitive)
        const isCorrect = correctAnswers.some(ans => ans.toLowerCase() === userAns.toLowerCase());

        if (isCorrect) {
            currentQ++;
            if (currentQ >= riddles.length) {
                finishGame();
            } else {
                // UI feedback for correct
                ui.feedback.style.color = "#00ff41";
                ui.feedback.innerText = "ACCESS GRANTED...";
                setTimeout(showQuestion, 800);
            }
        } else {
            // UI feedback for error
            ui.feedback.style.color = "#ff3333";
            ui.feedback.innerText = "ACCESS DENIED. TRY AGAIN.";
            ui.input.classList.add('blink');
            setTimeout(() => ui.input.classList.remove('blink'), 500);
        }
    }

    function finishGame() {
        clearInterval(timerInterval);
        const finalTimeVal = ((Date.now() - startTime) / 1000).toFixed(2);
        ui.finalTime.innerText = finalTimeVal;
        switchScreen('result');
    }

    // Allow Enter key to submit
    ui.input.addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
            checkAnswer();
        }
    });

</script>
</body>
</html>